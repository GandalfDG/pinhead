[gd_scene load_steps=14 format=3 uid="uid://cgdjulw3q7axd"]

[ext_resource type="Script" path="res://elements/pop_bumper/pop_bumper.gd" id="1_hvtx7"]
[ext_resource type="Script" path="res://elements/pop_bumper/Kicker.gd" id="2_8lq0t"]
[ext_resource type="PackedScene" uid="uid://brj6pblp2w8hj" path="res://utilities/LinearSolenoidSpring.tscn" id="3_6ga7p"]
[ext_resource type="Material" uid="uid://b43rlaqm12whx" path="res://materials/ball.tres" id="3_y3ayh"]
[ext_resource type="PackedScene" uid="uid://dm3kn01moydlq" path="res://utilities/LocalAxisLock.tscn" id="5_vun6y"]

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_42nhi"]
albedo_color = Color(1, 0.160784, 0.160784, 1)
emission_enabled = true
emission = Color(1, 0, 0, 1)
emission_energy_multiplier = 0.47

[sub_resource type="CylinderMesh" id="CylinderMesh_xa0o1"]
material = SubResource("StandardMaterial3D_42nhi")
top_radius = 0.2
bottom_radius = 0.25
height = 0.1

[sub_resource type="CylinderMesh" id="CylinderMesh_eqae3"]
top_radius = 0.1
bottom_radius = 0.1
height = 0.3

[sub_resource type="CylinderShape3D" id="CylinderShape3D_xxs4f"]
height = 0.3
radius = 0.1

[sub_resource type="CylinderShape3D" id="CylinderShape3D_hpw4f"]
height = 0.3
radius = 0.141623

[sub_resource type="CylinderMesh" id="CylinderMesh_it0wu"]
material = ExtResource("3_y3ayh")
top_radius = 0.2
bottom_radius = 0.1
height = 0.08

[sub_resource type="ConvexPolygonShape3D" id="ConvexPolygonShape3D_qb4g8"]
points = PackedVector3Array(0.0331713, 0.04, 0.177052, -0.0362507, 0.0375382, -0.193488, -0.0331713, 0.04, -0.177052, 0.193502, 0.037549, -0.0362531, -0.0924725, -0.0392027, 0.040459, -0.193488, 0.0375382, 0.0362506, 0.0982199, -0.0391979, -0.0231063, -0.0687235, -0.0388293, -0.0744654, 0.0687234, -0.0388293, 0.0744654, -0.0781204, 0.0373344, 0.180347, 0.101847, 0.0372267, -0.167829, 0.167819, 0.0372327, 0.101878, -0.167808, 0.0372221, -0.101871, 0.0230662, -0.0391911, -0.0982397, -0.0231011, -0.0391888, 0.098234, 0.0362506, 0.0375382, 0.193488, -0.0982205, -0.0391981, -0.0231065, -0.155563, 0.0371605, 0.119652, 0.155596, 0.0371764, -0.11964, -0.177052, 0.04, 0.0331713, 0.177052, 0.04, -0.0331713, -0.119652, 0.0371605, -0.155563, 0.119652, 0.0371605, 0.155563, 0.0982205, -0.0391981, 0.0231065, 0.0687221, -0.0388285, -0.0744639, 0.19349, 0.0375468, 0.036251, -0.193477, 0.0375361, -0.0362485, 0.0362485, 0.0375361, -0.193477, -0.0687221, -0.0388285, 0.0744639, -0.0404182, -0.0391982, -0.0924983, 0.0404502, -0.039194, 0.0924888, -0.0362485, 0.0375361, 0.193477)

[sub_resource type="CylinderShape3D" id="CylinderShape3D_jlmpe"]
height = 0.333283
radius = 0.201343

[node name="PopBumper" type="Node3D"]
editor_description = "a pop bumper detects when the ball comes near and activates its kicker, sending the ball away at high speed."
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.147503, 0)
script = ExtResource("1_hvtx7")

[node name="BumperCapMesh" type="MeshInstance3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.191129, 0)
mesh = SubResource("CylinderMesh_xa0o1")

[node name="BumperBodyMesh" type="MeshInstance3D" parent="."]
mesh = SubResource("CylinderMesh_eqae3")

[node name="BodyCollider" type="StaticBody3D" parent="BumperBodyMesh"]
collision_layer = 2
collision_mask = 0

[node name="CollisionShape3D" type="CollisionShape3D" parent="BumperBodyMesh/BodyCollider"]
shape = SubResource("CylinderShape3D_xxs4f")

[node name="PopTrigger" type="Area3D" parent="BumperBodyMesh"]
collision_layer = 0
collision_mask = 8

[node name="TriggerArea" type="CollisionShape3D" parent="BumperBodyMesh/PopTrigger"]
shape = SubResource("CylinderShape3D_hpw4f")

[node name="Kicker" type="Node3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.065191, 0)

[node name="JoltSliderJoint3D" type="JoltSliderJoint3D" parent="Kicker"]
limit_enabled = true
limit_lower = -0.1
limit_spring_frequency = 100.0
limit_spring_damping = 0.1
node_b = NodePath("../Kicker")
transform = Transform3D(-4.37114e-08, 1, 0, -1, -4.37114e-08, 0, 0, 0, 1, 0, 0, 0)

[node name="Kicker" type="RigidBody3D" parent="Kicker"]
collision_layer = 4
collision_mask = 0
mass = 0.1
continuous_cd = true
linear_damp = 6.063
script = ExtResource("2_8lq0t")

[node name="LinearSolenoidSpring" parent="Kicker/Kicker" instance=ExtResource("3_6ga7p")]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, 0, 0, 0)
solenoid_force = 0.5
spring_stiffness = 500.0
resting_spring_extension = 0.001

[node name="LocalAxisLock" parent="Kicker/Kicker" instance=ExtResource("5_vun6y")]
lock_translation_x = true
lock_translation_z = true
lock_rotation_x = true
lock_rotation_y = true
lock_rotation_z = true

[node name="KickerMesh" type="MeshInstance3D" parent="Kicker/Kicker"]
mesh = SubResource("CylinderMesh_it0wu")
skeleton = NodePath("../..")

[node name="CollisionShape3D" type="CollisionShape3D" parent="Kicker/Kicker"]
shape = SubResource("ConvexPolygonShape3D_qb4g8")

[node name="CollisionShape3D2" type="CollisionShape3D" parent="Kicker/Kicker"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.209276, 0)
shape = SubResource("CylinderShape3D_jlmpe")

[connection signal="body_entered" from="BumperBodyMesh/PopTrigger" to="." method="_on_pop_trigger_body_entered"]
[connection signal="body_entered" from="BumperBodyMesh/PopTrigger" to="Kicker/Kicker" method="_on_pop_trigger_body_entered"]
